# 使用预处理数据

部分算法有离线预处理步骤以计算辅助数据。预计算数据随后被加载并用于提升在线规划性能。 
辅助数据示例包括机器学习模型（权重）、强边界启发式以及用于剪枝搜索空间的复杂约束。
这些可在预处理步骤中计算，或从您的「大文件存储」位置加载。
另一种情况是编译时所需的大体积依赖。
若您的提交使用此类辅助数据与依赖，本文档说明如何与之配合使用。

## 生成辅助数据

辅助数据的生成由每位参赛者自行负责。我们假定您有可读取与分析问题实例的外部程序。这些程序在本地（您的机器或云实例）运行，所需时间不限（例如数天）。 
它们也可与您的规划器交互，但不应直接在规划器中实现这些流程。 
而应在每次提交的评测中，作为我们 30 分钟预处理步骤的一部分，由规划器加载生成的辅助数据。 

竞赛结束后我们会将您的提交开源。因此建议将生成辅助数据的代码加入提交仓库，以便社区成员日后复现您的结果，并可能促进您实现的更广泛采用。

## 加载辅助数据

假设您的辅助数据名为 `example.data`，位于本地机器的 `/tmp` 目录。 
您需要让规划器能访问该文件：
- 可使用 start-kit 参数 `--fileStoragePath` 指定辅助数据所在目录，本例中为 `--fileStoragePath /tmp`：
- 若未指定 `--fileStoragePath`，start-kit 会先读取环境变量 `LORR_LARGE_FILE_STORAGE_PATH` 的值。
路径值会存储在 `env->file_storage_path`，您的程序可在初始化和规划时访问。

示例：
```
./build/lifelong --inputFile ./example_problems/random.domain/random_20.json -o test.json --fileStoragePath /tmp
```

评测开始前，start-kit 环境会调用您将实现的 `MAPFPlanner::initialize` 函数。 
通过读取变量 `MAPFPlanner::env->file_storage_path` 定位辅助数据。例如要加载 `example.data`，规划器可读取 
`
path  = env->file_storage_path + "/example.data"
`。
您有 30 分钟时间加载辅助数据文件并初始化支持数据结构。
这些数据将在在线评测期间供规划器使用。 

## 存储辅助数据

辅助数据文件可能较大，不应放入提交仓库。
我们提供大文件托管服务以达到相同效果。

进入「我的提交」页面：
- 页面底部有「大文件存储」按钮。
- 点击该按钮打开存储管理面板。
- 使用该面板上传或删除文件。

上传的文件会在评测开始时同步到评测服务器。
存储这些文件的目录会以只读方式挂载到 Docker 容器。
您的所有提交均可访问该目录。
若某次提交需要更新辅助数据，请通过「我的提交」页面手动删除并重新上传。

## 使用大文件存储管理依赖 

有时程序有无法上传到提交仓库的大型编译时依赖。您也可以使用大文件存储来应对。编译时我们会将环境变量 `LORR_LARGE_FILE_STORAGE_PATH` 初始化为您的大文件存储目录。您可以在编译脚本中引用该变量来查找依赖。
